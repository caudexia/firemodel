{"version":3,"sources":["../../src/server/index.ts","../../src/BaseModel.ts"],"sourcesContent":["import { ZodSchema, ZodTypeDef } from 'zod';\nimport admin from 'firebase-admin';\nimport { createModel } from '../BaseModel';\n\nlet firestoreInstance: ReturnType<typeof admin.firestore> | null = null;\n\n/**\n * Gets the initialized Firestore instance for server.\n * \n * @returns {ReturnType<typeof firestore>} - The Firestore instance for server.\n * @throws {Error} - Throws an error if the firemodel has not been initialized.\n */\nexport const getFirestoreInstanceServer = (): ReturnType<typeof admin.firestore> => {\n  if (!firestoreInstance) {\n    throw new Error('firemodel has not been initialized. Please call the initializeServer function first.');\n  }\n\n  return firestoreInstance;\n};\n\n/**\n * Initializes the firemodel package with the given Firebase Admin SDK credentials for server.\n * \n * @param {admin.ServiceAccount} config - Firebase Admin SDK credentials.\n * @param {string} databaseURL - Database URL for Firebase Admin SDK.\n */\nexport const initializeServer = (config: admin.ServiceAccount, databaseURL: string): void => {\n  admin.initializeApp({\n    credential: admin.credential.cert(config),\n    databaseURL: databaseURL\n  });\n\n  firestoreInstance = admin.firestore();\n};\n\n/**\n * Creates a server model with methods tailored for the Firebase Admin SDK.\n * \n * @template IInput - The type of the data model used for input (to be validated).\n * @template IOutput - The type of the data model used for output (to be returned).\n * @param {string} collectionName - The name of the Firestore collection.\n * @param {ZodSchema<IOutput, ZodTypeDef, IInput>} schema - The Zod schema for data validation.\n * @returns {ReturnType<typeof createModel<IInput, IOutput>>} - The methods associated with the web model.\n */\nexport const createServerModel = <IInput, IOutput>(collectionName: string, schema: ZodSchema<IOutput, ZodTypeDef, IInput>) => {\n  const baseModel = createModel(collectionName, schema);\n  const db = admin.firestore();\n\n  return {\n    ...baseModel,\n\n    /**\n     * Fetches a document by its ID.\n     * \n     * @param {string} id - The ID of the document to fetch.\n     * @returns {Promise<IOutput | undefined>} - The fetched document or undefined if not found.\n     */\n    async get(id: string): Promise<IOutput | undefined> {\n      const docSnap = await db.collection(collectionName).doc(id).get();\n\n      if (docSnap.exists) {\n        return baseModel.validate(docSnap.data() as IInput);\n      }\n\n      return undefined;\n    },\n\n    /**\n     * Adds a new document to the collection.\n     * \n     * @param {IInput} data - The data of the document to add.\n     * @returns {Promise<string>} - The ID of the added document.\n     */\n    async add(data: IInput): Promise<string> {\n      const validatedData = baseModel.validate(data);\n\n      if (!validatedData) {\n        throw new Error('firemodel: Validation failed for the provided data.');\n      }\n\n      const docRef = await db.collection(collectionName).add(validatedData);\n      return docRef.id;\n    },\n\n    /**\n     * Updates an existing document in the collection.\n     * \n     * @param {string} id - The ID of the document to update.\n     * @param {Partial<IInput>} data - The data to update in the document.\n     * @returns {Promise<void>} - Resolves when the update is successful.\n     * @throws {Error} - Throws an error if validation fails or if other issues arise during the update.\n     */\n    async update(id: string, data: Partial<IInput>): Promise<void> {\n      const validatedData = baseModel.validate(data);\n\n      if (!validatedData) {\n        throw new Error('firemodel: Validation failed for the provided data.');\n      }\n\n      // https://github.com/googleapis/nodejs-firestore/issues/1745\n      await db.collection(collectionName).doc(id).update(validatedData as any);\n    },\n\n    /**\n     * Deletes a document from the collection by its ID.\n     * \n     * @param {string} id - The ID of the document to delete.\n     * @returns {Promise<void>} - Resolves when the deletion is successful.\n     * @throws {Error} - Throws an error if issues arise during the deletion.\n     */\n    async delete(id: string): Promise<void> {\n      await db.collection(collectionName).doc(id).delete();\n    },\n  };\n};\n","import { ZodSchema, ZodTypeDef } from 'zod';\n\ninterface ModelMethods<IInput, IOutput> {\n  validate: (data: Partial<IInput>) => IOutput | undefined;\n  get: (id: string) => Promise<IOutput | undefined>;\n  add: (data: IInput) => Promise<string>;\n  update: (id: string, data: Partial<IInput>) => Promise<void>;\n  delete: (id: string) => Promise<void>;\n}\n\n/**\n * Creates a base model with common methods for data validation and manipulation.\n * \n * @template IInput - The type of the data model used for input.\n * @template IOutput - The type of the data model used for output.\n * @param {string} _collectionName - The name of the Firestore collection.\n * @param {ZodSchema<IInput>} schema - The Zod schema for data validation.\n * @returns {ModelMethods<IInput, IOutput>} - The methods associated with the model.\n */\nexport function createModel<IInput, IOutput>(_collectionName: string, schema: ZodSchema<IOutput, ZodTypeDef, IInput>): ModelMethods<IInput, IOutput> {\n  return {\n    validate(data: Partial<IInput>): IOutput | undefined {\n      return schema.parse(data);\n    },\n    async get(_id: string): Promise<IOutput | undefined> {\n      throw new Error(\"Method not implemented.\");\n    },\n    async add(_data: IInput): Promise<string> {\n      throw new Error(\"Method not implemented.\");\n    },\n    async update(_id: string, _data: Partial<IInput>): Promise<void> {\n      throw new Error(\"Method not implemented.\");\n    },\n    async delete(_id: string): Promise<void> {\n      throw new Error(\"Method not implemented.\");\n    },\n  };\n}\n"],"mappings":"0jBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,uBAAAE,EAAA,+BAAAC,EAAA,qBAAAC,IAAA,eAAAC,EAAAL,GACA,IAAAM,EAAkB,6BCkBX,SAASC,EAA6BC,EAAyBC,EAA+E,CACnJ,MAAO,CACL,SAASC,EAA4C,CACnD,OAAOD,EAAO,MAAMC,CAAI,CAC1B,EACA,MAAM,IAAIC,EAA2C,CACnD,MAAM,IAAI,MAAM,yBAAyB,CAC3C,EACA,MAAM,IAAIC,EAAgC,CACxC,MAAM,IAAI,MAAM,yBAAyB,CAC3C,EACA,MAAM,OAAOD,EAAaC,EAAuC,CAC/D,MAAM,IAAI,MAAM,yBAAyB,CAC3C,EACA,MAAM,OAAOD,EAA4B,CACvC,MAAM,IAAI,MAAM,yBAAyB,CAC3C,CACF,CACF,CDjCA,IAAIE,EAA+D,KAQtDC,EAA6B,IAA0C,CAClF,GAAI,CAACD,EACH,MAAM,IAAI,MAAM,sFAAsF,EAGxG,OAAOA,CACT,EAQaE,EAAmB,CAACC,EAA8BC,IAA8B,CAC3F,EAAAC,QAAM,cAAc,CAClB,WAAY,EAAAA,QAAM,WAAW,KAAKF,CAAM,EACxC,YAAaC,CACf,CAAC,EAEDJ,EAAoB,EAAAK,QAAM,UAAU,CACtC,EAWaC,EAAoB,CAAkBC,EAAwBC,IAAmD,CAC5H,IAAMC,EAAYC,EAAYH,EAAgBC,CAAM,EAC9CG,EAAK,EAAAN,QAAM,UAAU,EAE3B,MAAO,CACL,GAAGI,EAQH,MAAM,IAAIG,EAA0C,CAClD,IAAMC,EAAU,MAAMF,EAAG,WAAWJ,CAAc,EAAE,IAAIK,CAAE,EAAE,IAAI,EAEhE,GAAIC,EAAQ,OACV,OAAOJ,EAAU,SAASI,EAAQ,KAAK,CAAW,CAItD,EAQA,MAAM,IAAIC,EAA+B,CACvC,IAAMC,EAAgBN,EAAU,SAASK,CAAI,EAE7C,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,qDAAqD,EAIvE,OADe,MAAMJ,EAAG,WAAWJ,CAAc,EAAE,IAAIQ,CAAa,GACtD,EAChB,EAUA,MAAM,OAAOH,EAAYE,EAAsC,CAC7D,IAAMC,EAAgBN,EAAU,SAASK,CAAI,EAE7C,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,qDAAqD,EAIvE,MAAMJ,EAAG,WAAWJ,CAAc,EAAE,IAAIK,CAAE,EAAE,OAAOG,CAAoB,CACzE,EASA,MAAM,OAAOH,EAA2B,CACtC,MAAMD,EAAG,WAAWJ,CAAc,EAAE,IAAIK,CAAE,EAAE,OAAO,CACrD,CACF,CACF","names":["server_exports","__export","createServerModel","getFirestoreInstanceServer","initializeServer","__toCommonJS","import_firebase_admin","createModel","_collectionName","schema","data","_id","_data","firestoreInstance","getFirestoreInstanceServer","initializeServer","config","databaseURL","admin","createServerModel","collectionName","schema","baseModel","createModel","db","id","docSnap","data","validatedData"]}